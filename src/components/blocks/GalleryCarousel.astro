---
import Container from "../ui/Container.astro";

const galleryItems = [
  {
    id: "rodinny-dum-1",
    title: "Rodinný dům - Kompletní realizace",
    description:
      "Moderní rodinný dům postavený s důrazem na kvalitu a detail. Kompletní realizace od základů po střechu.",
    href: "/realizace/rodinny-dum-1",
    image: "/images-work/skyinvest_images/dum1/IMG_4828-1030x773.jpg",
  },
  {
    id: "rodinny-dum-6",
    title: "Rodinný dům s moderní architekturou",
    description:
      "Stavba rodinného domu s moderními prvky a funkčním uspořádáním. Realizace podle požadavků klienta.",
    href: "/realizace/rodinny-dum-6",
    image: "/images-work/skyinvest_images/dum6/DSCN6557.jpg",
  },
  {
    id: "rodinny-dum-5",
    title: "Rodinný dům s interiérem",
    description:
      "Kompletní realizace rodinného domu včetně moderních interiérů a finálních úprav.",
    href: "/realizace/rodinny-dum-5",
    image: "/images-work/skyinvest_images/dum5/DSCN1880-e1589460887235.jpg",
  },
  {
    id: "bytova-jednotka-1",
    title: "Bytová jednotka - moderní bydlení",
    description:
      "Realizace moderní bytové jednotky s důrazem na funkčnost a estetiku prostoru.",
    href: "/realizace/bytova-jednotka-1",
    image: "/images-work/skyinvest_images/byt1/s1200_IMG-3222.jpg",
  },
  {
    id: "rodinny-dum-2",
    title: "Rodinný dům - přestavba",
    description:
      "Kompletní rekonstrukce a modernizace rodinného domu s novými interiéry a fasádou.",
    href: "/realizace/rodinny-dum-2",
    image: "/images-work/skyinvest_images/dum2/Obyvaci_pokoj-1030x773.jpg",
  },
];
---

<section class="py-32 bg-gradient-to-b from-background to-frosted-blue/10">
  <Container>
    <div class="mb-8 flex items-end justify-between md:mb-14 lg:mb-16">
      <div class="flex flex-col gap-4">
        <h2 class="text-3xl font-medium md:text-4xl lg:text-5xl">
          Galerie projektů
        </h2>
        <p class="max-w-lg text-muted-foreground">
          Prohlédněte si naše vybrané projekty a nechte se inspirovat. Každý
          projekt je pro nás jedinečný.
        </p>
      </div>
      <div class="hidden shrink-0 gap-2 md:flex">
        <button
          id="gallery-prev"
          class="inline-flex items-center justify-center size-10 rounded-lg border border-border bg-background hover:bg-accent transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          aria-label="Předchozí"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="w-5 h-5"
          >
            <path d="m15 18-6-6 6-6"></path>
          </svg>
        </button>
        <button
          id="gallery-next"
          class="inline-flex items-center justify-center size-10 rounded-lg border border-border bg-background hover:bg-accent transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          aria-label="Další"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="w-5 h-5"
          >
            <path d="m9 18 6-6-6-6"></path>
          </svg>
        </button>
      </div>
    </div>
  </Container>

  <div class="w-full overflow-hidden">
    <div
      id="gallery-carousel"
      class="flex gap-5 px-6 md:px-8 lg:px-[max(2rem,calc(50vw-700px))] transition-transform duration-500 ease-out"
      style="transform: translateX(0)"
    >
      {
        galleryItems.map((item) => (
          <a
            href={item.href}
            class="group flex-shrink-0 w-[320px] lg:w-[360px] rounded-xl overflow-hidden"
          >
            <div class="relative h-full min-h-[27rem] overflow-hidden rounded-xl">
              <img
                src={item.image}
                alt={item.title}
                class="absolute h-full w-full object-cover object-center transition-transform duration-300 group-hover:scale-105"
              />
              <div class="absolute inset-x-0 bottom-0 bg-oxford-navy/50 backdrop-blur-sm rounded-2xl p-8 lg:p-10 m-4 text-honeydew">
                <div class="relative z-10 mb-2 pt-0 text-xl font-semibold md:mb-3">
                  {item.title}
                </div>
                <div class="relative z-10 mb-6 line-clamp-2 md:mb-8 lg:mb-6 text-frosted-blue">
                  {item.description}
                </div>
                <div class="relative z-10 flex items-center text-sm text-honeydew">
                  Zobrazit detail
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="ml-2 w-5 h-5 transition-transform group-hover:translate-x-1"
                  >
                    <path d="M5 12h14" />
                    <path d="m12 5 7 7-7 7" />
                  </svg>
                </div>
              </div>
            </div>
          </a>
        ))
      }
    </div>
  </div>

  <!-- Slide Indicators -->
  <div class="mt-8 flex justify-center gap-2">
    {
      galleryItems.map((_, index) => (
        <button
          class="gallery-indicator h-2 w-2 rounded-full transition-colors bg-primary/20"
          data-index={index}
          aria-label={`Přejít na snímek ${index + 1}`}
        />
      ))
    }
  </div>
</section>

<script>
  const carousel = document.getElementById("gallery-carousel");
  const prevBtn = document.getElementById("gallery-prev");
  const nextBtn = document.getElementById("gallery-next");
  const indicators = document.querySelectorAll(".gallery-indicator");

  let currentIndex = 0;
  const itemWidth = 340; // 320px + 20px gap
  const totalItems = indicators.length;

  function updateCarousel() {
    if (!carousel) return;

    const offset = -currentIndex * itemWidth;
    carousel.style.transform = `translateX(${offset}px)`;

    // Update indicators
    indicators.forEach((indicator, index) => {
      if (index === currentIndex) {
        indicator.classList.remove("bg-primary/20");
        indicator.classList.add("bg-primary");
      } else {
        indicator.classList.remove("bg-primary");
        indicator.classList.add("bg-primary/20");
      }
    });

    // Update button states
    if (prevBtn) {
      prevBtn.disabled = currentIndex === 0;
    }
    if (nextBtn) {
      nextBtn.disabled = currentIndex === totalItems - 1;
    }
  }

  if (prevBtn) {
    prevBtn.addEventListener("click", () => {
      if (currentIndex > 0) {
        currentIndex--;
        updateCarousel();
      }
    });
  }

  if (nextBtn) {
    nextBtn.addEventListener("click", () => {
      if (currentIndex < totalItems - 1) {
        currentIndex++;
        updateCarousel();
      }
    });
  }

  indicators.forEach((indicator, index) => {
    indicator.addEventListener("click", () => {
      currentIndex = index;
      updateCarousel();
    });
  });

  // Touch/swipe support
  let touchStartX = 0;
  let touchEndX = 0;

  if (carousel) {
    carousel.addEventListener("touchstart", (e) => {
      touchStartX = e.changedTouches[0].screenX;
    });

    carousel.addEventListener("touchend", (e) => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    });
  }

  function handleSwipe() {
    if (touchEndX < touchStartX - 50 && currentIndex < totalItems - 1) {
      currentIndex++;
      updateCarousel();
    }
    if (touchEndX > touchStartX + 50 && currentIndex > 0) {
      currentIndex--;
      updateCarousel();
    }
  }

  // Horizontal scroll with shift key
  if (carousel) {
    carousel.addEventListener(
      "wheel",
      (e) => {
        if (e.shiftKey) {
          e.preventDefault();
          const scrollAmount = e.deltaY;

          if (scrollAmount > 0 && currentIndex < totalItems - 1) {
            currentIndex++;
            updateCarousel();
          } else if (scrollAmount < 0 && currentIndex > 0) {
            currentIndex--;
            updateCarousel();
          }
        }
      },
      { passive: false },
    );
  }

  // Initialize
  updateCarousel();
</script>
